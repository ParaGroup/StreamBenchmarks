/** 
 *  @file    event.hpp
 *  @author  Gabriele Mencagli
 *  @date    14/08/2019
 *  
 *  @brief Structure of a input tuple
 *  
 *  This file defines the structure of the tuples generated by the source.
 *  The data type event_t must be default constructible, with a copy constructor
 *  and copy assignment operator, and it must provide and implement the setInfo() and
 *  getInfo() methods.
 */

#ifndef YSB_EVENT_HPP
#define YSB_EVENT_HPP

#include <windflow.hpp>

using namespace std;

// event_t struct
struct event_t
{
    unsigned long ts; // timestamp
    unsigned long user_id; // user id
    unsigned long page_id; // page id
    unsigned long ad_id; // advertisement id
    unsigned int ad_type; // advertisement type (0, 1, 2, 3, 4) => ("banner", "modal", "sponsored-search", "mail", "mobile")
    unsigned int event_type; // event type (0, 1, 2) => ("view", "click", "purchase")
    unsigned int ip; // ip address
    char padding[20]; // padding

    // constructor
    event_t() {}

    // destructor
    ~event_t() {}

    // getControlFields method (needed by the WindFlow library)
    tuple<size_t, uint64_t, uint64_t> getControlFields() const
    {
        return tuple<size_t, uint64_t, uint64_t>((size_t) event_type, (uint64_t) 0, (uint64_t) ts); // be careful with this cast!
    }

    // setControlFields method (needed by the WindFlow library)
    void setControlFields(size_t _key, uint64_t _id, uint64_t _ts)
    {
        event_type = (long) _key;
        ts = (long) _ts;
    }
};

#endif //YSB_EVENT_HPP
